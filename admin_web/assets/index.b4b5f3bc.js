import{_ as e,a as t,b as a,u as l,r as s}from"./index.b3300bbf.js";import{d as n,f as o,o as i,q as c,x as r,C as u,r as d,a as m,w as p,c as g,F as f,G as v,H as h,J as b,K as T,L as k,M as w,k as x,l as y,D as C,h as _,A as S,u as L,N as M,O as I,P as z,Q as H,n as P,R,B,S as A,T as W,U as E,V as F,W as O}from"./element-plus.4376cb67.js";const D=n({setup(){const e=t();return{formatTitle:o((()=>"管理")),goHome:()=>{e.push("/")}}}}),j={class:"brand"},$={class:"title"};var q=e(D,[["render",function(e,t,a,l,s,n){return i(),c("div",j,[r("img",{class:"logo",src:"./assets/logo.1d6978fb.svg",onClick:t[0]||(t[0]=(...t)=>e.goHome&&e.goHome(...t))}),r("div",$,"國際"+u(e.formatTitle)+"平台",1)])}],["__scopeId","data-v-b5ad4e90"]]);const N=n({props:["title","icon"],setup:({icon:e})=>({isElementIcon:o((()=>e&&e.startsWith("el-icon")))})});const U=n({name:"Submenu",components:{Item:e(N,[["render",function(e,t,a,l,s,n){const o=d("el-icon");return i(),c(v,null,[m(o,null,{default:p((()=>[(i(),g(f(e.icon)))])),_:1}),r("span",null,u(e.title),1)],64)}],["__scopeId","data-v-2c21318c"]])},props:{menu:{type:Object,required:!0},isNest:{type:Boolean,default:!1}}});var V={menuBg:"#304156",menuTextColor:"#fff",menuActiveTextColor:"#fff"};var Y=e(n({components:{Submenu:e(U,[["render",function(e,t,a,l,s,n){const o=d("item"),r=d("el-menu-item"),u=d("submenu",!0),f=d("el-sub-menu");return e.menu.children?(i(),g(f,{key:1,index:e.menu.url},{title:p((()=>[m(o,{icon:e.menu.icon,title:e.menu.title},null,8,["icon","title"])])),default:p((()=>[(i(!0),c(v,null,h(e.menu.children,(e=>(i(),g(u,{key:e.url,"is-nest":!0,menu:e},null,8,["menu"])))),128))])),_:1},8,["index"])):(i(),g(r,{key:0,index:e.menu.url},{default:p((()=>[m(o,{icon:e.menu.icon,title:e.menu.title},null,8,["icon","title"])])),_:1},8,["index"]))}]])},props:{collapse:{type:Boolean,default:!1},mode:{type:String,default:"vertical"}},setup(){const e=a(),t=l();return{menus:o((()=>t.state.menu.menus)),activePath:o((()=>e.path)),variables:o((()=>V))}}}),[["render",function(e,t,a,l,s,n){const o=d("submenu"),r=d("el-menu"),u=d("el-scrollbar");return i(),g(u,{class:"scroll"},{default:p((()=>[m(r,{class:"menu",mode:e.mode,collapse:e.collapse,"collapse-transition":!1,uniqueOpened:!0,router:!0,"default-active":e.activePath,"background-color":e.variables.menuBg,"text-color":e.variables.menuTextColor,"active-text-color":e.variables.menuActiveTextColor},{default:p((()=>[(i(!0),c(v,null,h(e.menus,(e=>(i(),g(o,{key:e.url,menu:e},null,8,["menu"])))),128))])),_:1},8,["mode","collapse","default-active","background-color","text-color","active-text-color"])])),_:1})}],["__scopeId","data-v-6ce2b084"]]);var G=e(n({components:{Logo:q,Menus:Y},setup(){const e=l(),t=o((()=>!!e.state.app.sidebar.collapse)),a=o((()=>e.state.app.device));return b((async()=>{await e.dispatch("menu/generateMenus"),await e.dispatch("variables/getVariables")})),{collapse:t,device:a,closeSidebar:()=>{e.commit("app/setCollapse",1)}}}}),[["render",function(e,t,a,l,s,n){const o=d("logo"),u=d("menus");return i(),c(v,null,[r("div",{class:T(["left z-10",{isCollapse:e.collapse,mobile:"mobile"===e.device}])},[m(o),m(u,{collapse:e.collapse},null,8,["collapse"])],2),r("div",{class:"mask",onClick:t[0]||(t[0]=(...t)=>e.closeSidebar&&e.closeSidebar(...t))})],64)}],["__scopeId","data-v-b75ed0fa"]]);const J=n({setup(){const e=l(),t=o((()=>!!e.state.app.sidebar.collapse));return{collapse:t,handleToggleMenu:()=>{e.commit("app/setCollapse",+!t.value)}}}}),K=[(e=>(k("data-v-13a17244"),e=e(),w(),e))((()=>r("path",{d:"M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM142.4 642.1L298.7 519a8.84 8.84 0 0 0 0-13.9L142.4 381.9c-5.8-4.6-14.4-.5-14.4 6.9v246.3a8.9 8.9 0 0 0 14.4 7z"},null,-1)))];var Q=e(J,[["render",function(e,t,a,l,s,n){return i(),c("div",{onClick:t[0]||(t[0]=(...t)=>e.handleToggleMenu&&e.handleToggleMenu(...t))},[(i(),c("svg",{class:T([{"rotate-180 isCollapse":e.collapse},"fold-btn"]),viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg",width:"36",height:"36"},K,2))])}],["__scopeId","data-v-13a17244"]]);var X=e(n({setup(e,{emit:a}){const s=l(),n=o((()=>s.state.app.device)),i=t().currentRoute,c=x([]),r=o((()=>s.state.layoutSettings)),u=o((()=>"horizontal"===r.value.menus.mode)),d=e=>{const t=[{path:"/",meta:{title:"首頁"}}];if("home"===e.name)return t;{const a=e.matched.filter((e=>!!e.meta&&!!e.meta.title));return[...t,...a]}};return b((()=>{c.value=d(i.value)})),y(i,(e=>{c.value=d(e),a("on-breadcrumbs-change",c.value.length>1)}),{immediate:!0}),{device:n,breadcrumbs:c,isHorizontalMenu:u}}}),[["render",function(e,t,a,l,s,n){const o=d("el-breadcrumb-item"),r=d("el-breadcrumb");return i(),g(r,{"separator-icon":"ArrowRight",class:T(["breadcrumb",{mobile:"mobile"===e.device,show:e.isHorizontalMenu,hide:e.breadcrumbs.length<=1}])},{default:p((()=>[(i(!0),c(v,null,h(e.breadcrumbs,((t,a)=>(i(),g(o,{key:a,class:T({no_link:a===e.breadcrumbs.length-1}),to:a<e.breadcrumbs.length-1?t.path:""},{default:p((()=>[C(u(t.meta.title),1)])),_:2},1032,["class","to"])))),128))])),_:1},8,["class"])}],["__scopeId","data-v-7c4a230e"]]);const Z=e=>s({url:"api/changeToken.php",method:"post",data:e}),ee={class:"flex items-center gap-x-3"},te={key:0},ae={key:1},le={key:0,class:"p-1 min-w-[240px] md:min-w-fit"},se=r("p",{class:"text-xs border-b text-gray-500 tracking-widest pb-1"}," 切換代理 ",-1),ne={class:"flex justify-between items-center"},oe={class:"flex items-center gap-x-3 w-full lg:min-w-[240px]"},ie={class:"w-8 h-8 flex bg-primary-50 rounded-full justify-center items-center text-white text-center lg:text-lg"},ce={class:"flex flex-col"},re={class:"text-md"},ue={class:"text-gray-500"},de=r("span",{class:"text-gray-300"},"｜",-1),me={key:0,class:"min-w-fit px-1 text-primary-500 tracking-wide cursor-default"},pe={__name:"ChangeTokenDropdown",setup(e){const{proxy:t}=H(),a=l(),s=_({loading:!1,model:{action:null,id:null}}),n=o((()=>a.state.changeRoleInfo.changeRoleInfoList)),f=o((()=>a.state.changeRoleInfo.changeRoleInfo));S((()=>{b.handleSubagentList()}));const b={handleSubagentList:async()=>{if(n.value)return;s.loading=!0;const{code:e,data:l,msg:o}=await Z({action:"getsubagent"});if(1===e){if(a.commit("changeRoleInfo/setChangeRoleInfoList",l),f.value)return;const e=n.value[0];b.handleChangeToken(e)}else t.$message({type:"error",message:o});s.loading=!1},handleChangeToken:async e=>{s.loading=!0;const l={action:"agent",id:e.agid},{code:n,token:o,info:i,msg:c}=await Z(l);1===n?(a.dispatch("app/setToken",o),a.commit("changeRoleInfo/setChangeRoleInfo",e),setTimeout((()=>{window.location.reload()}),300)):t.$message({type:"error",message:c}),s.loading=!1}};return(e,t)=>{const a=d("el-icon"),l=d("el-button"),s=d("el-dropdown");return i(),g(s,null,{dropdown:p((()=>[L(M)(L(n))?I("",!0):(i(),c("div",le,[se,(i(!0),c(v,null,h(L(n),(e=>{var t;return i(),c("div",{key:e.mbid,class:"px-1 py-2 border-b last:border-b-0 hover:bg-gray-50 min-w-fit"},[r("div",ne,[r("div",oe,[r("div",ie,[r("p",null,u(e.mbname.substring(0,1)),1)]),r("div",ce,[r("p",re,u(e.mbname),1),r("p",ue,[C(u(e.agname)+" ",1),de,C(" "+u(e.agid),1)])])]),e.mbid==(null==(t=L(f))?void 0:t.mbid)?(i(),c("div",me," 當前代理 ")):(i(),g(l,{key:1,onClick:t=>b.handleChangeToken(e),type:"primary"},{default:p((()=>[C(" 切換 ")])),_:2},1032,["onClick"]))])])})),128))]))])),default:p((()=>[m(l,{plain:""},{default:p((()=>{var e,t;return[r("div",ee,[L(M)(L(f))?(i(),c("p",ae,"切換代理")):(i(),c("p",te,u(null==(e=L(f))?void 0:e.agname)+"｜"+u(null==(t=L(f))?void 0:t.mbname),1)),m(a,null,{default:p((()=>[m(L(z))])),_:1})])]})),_:1})])),_:1})}}};const ge=n({components:{},setup(){const e=l(),a=t(),{userinfo:s}=(()=>{const e=l();return{userinfo:o((()=>e.state.account.userinfo))}})();return{userinfo:s,logout:()=>{e.dispatch("app/clearToken"),a.push("/login")}}}}),fe={class:"userinfo"},ve=(e=>(k("data-v-d9564df0"),e=e(),w(),e))((()=>r("i",{class:"el-icon-user"},null,-1))),he=["src"];const be=n({components:{Logo:q,Hamburger:Q,Breadcrumbs:X,Userinfo:e(ge,[["render",function(e,t,a,l,s,n){const o=d("el-dropdown-item"),f=d("el-dropdown-menu"),h=d("el-dropdown");return i(),g(h,{trigger:"click"},{dropdown:p((()=>[m(f,null,{default:p((()=>[m(o,null,{default:p((()=>[C("個人中心")])),_:1}),m(o,{onClick:e.logout},{default:p((()=>[C("Logout")])),_:1},8,["onClick"])])),_:1})])),default:p((()=>[r("div",fe,[e.userinfo?(i(),c(v,{key:1},[r("img",{class:"avatar",src:e.userinfo.avatar},null,8,he),C(" "+u(e.userinfo.name),1)],64)):(i(),c(v,{key:0},[ve,C(" admin ")],64))])])),_:1})}],["__scopeId","data-v-d9564df0"]]),ChangeTokenDropdown:pe},setup(){const e=l(),t=o((()=>e.state.layoutSettings)),a=o((()=>e.state.app.device)),s=o((()=>"horizontal"===t.value.menus.mode)),n=o((()=>s.value||"mobile"===a.value)),i=o((()=>!s.value)),c=o((()=>t.value.breadcrumbs.isShow&&!s.value)),r=o((()=>!1));return{device:a,isHorizontalMenu:s,isShowLogo:n,isShowHamburger:i,isShowBreadcrumbs:c,isAgent:r}}}),Te={class:"navigation"},ke={class:"action"};var we=e(be,[["render",function(e,t,a,l,s,n){const o=d("logo"),u=d("hamburger"),p=d("breadcrumbs"),f=d("ChangeTokenDropdown"),v=d("userinfo");return i(),c("div",{class:T(["header",{"no-border":e.isHorizontalMenu}])},[r("div",Te,[e.isShowLogo?(i(),g(o,{key:0,class:T(["mobile",{"show-title":e.isHorizontalMenu}])},null,8,["class"])):I("",!0),e.isShowHamburger?(i(),g(u,{key:1})):I("",!0),e.isShowBreadcrumbs?(i(),g(p,{key:2})):I("",!0)]),r("div",ke,[e.isAgent?(i(),g(f,{key:0})):I("",!0),m(v)])],2)}],["__scopeId","data-v-6e505ca4"]]);const xe=e=>!!e.meta&&!!e.meta.affix,ye=()=>{const e=l(),a=t(),s=a.currentRoute,n=o((()=>a.getRoutes())),i=o((()=>e.state.tags.tagList)),c=x([]),r=(e=>{const t=x(null),a=x(0),l=e=>{a.value=e,t.value.setScrollLeft(a.value)};return{scrollContainer:t,handleScroll:e=>{const s=t.value.wrap$;if(s.offsetWidth+a.value>s.children[0].scrollWidth)return void l(s.children[0].scrollWidth-s.offsetWidth);if(a.value<0)return void l(0);const n=e.wheelDelta||-e.deltaY;l(a.value-n/4)},moveToTarget:a=>{const s=t.value.wrapRef,n=e.value;let o=null,i=null;if(n.length>0&&(o=n[0],i=n[n.length-1]),o===a)l(0);else if(i===a)l((null==s?void 0:s.children[0].scrollWidth)-(null==s?void 0:s.offsetWidth));else{const e=a.$el.nextElementSibling;e.offsetLeft+e.offsetWidth>s.offsetWidth?l(e.offsetLeft-e.offsetWidth):l(0)}}}})(c);y((()=>i.value.length),(()=>{c.value=[]}));const u=()=>{const t=n.value.filter((e=>xe(e)));for(const a of t)a.name&&e.dispatch("tags/addTag",a);i.value.filter((e=>n.value.every((t=>t.name!==e.name)))).forEach((t=>{e.dispatch("tags/delTag",t)}))},d=()=>{const t=s.value;t.name&&"layout"===t.matched[0].components.default.name&&e.dispatch("tags/addTag",t)},m=()=>{P((()=>{for(const t of c.value)if(t&&t.to.path===s.value.path){r.moveToTarget(t),t.to.fullPath!==s.value.fullPath&&e.dispatch("tags/updateTagList",s.value);break}}))};return b((()=>{u(),d(),m()})),y(s,((t,a)=>{(t=>{const a=i.value.findIndex((e=>e.fullPath===t.fullPath));e.dispatch("tags/saveActivePosition",Math.max(0,a))})(a),d(),m()})),{tagList:i,setItemRef:(e,t)=>{c.value[e]=t},isAffix:xe,...r}};const Ce=n({name:"Tagsbar",mounted(){H().appContext.config.globalProperties.$tagsbar=this},setup(){const e=l(),s=o((()=>e.state.layoutSettings)),n=o((()=>s.value.tagsbar.isShow)),i=ye(),c=(e=>{const s=l(),n=t(),o=a(),i=_({visible:!1,top:0,left:0,selectedTag:{},openMenu(e,t){i.visible=!0,i.left=t.clientX,i.top=t.clientY,i.selectedTag=e},closeMenu(){i.visible=!1},refreshSelectedTag(e){s.commit("tags/DEL_CACHE_LIST",e);const{fullPath:t}=e;P((()=>{n.replace({path:"/redirect"+t})}))},closeTag(t){if(xe(t))return;const a=e.value.findIndex((e=>e.fullPath===t.fullPath));s.dispatch("tags/delTag",t),c(t)&&r(a-1)},closeOtherTags(){s.dispatch("tags/delOtherTags",i.selectedTag),n.push(i.selectedTag)},closeLeftTags(){i.closeSomeTags("left")},closeRightTags(){i.closeSomeTags("right")},closeSomeTags(t){const a=e.value.findIndex((e=>e.fullPath===i.selectedTag.fullPath));if("left"===t&&a<=0||"right"===t&&a>=e.value.length-1)return;const l="left"===t?e.value.slice(0,a):e.value.slice(a+1);s.dispatch("tags/delSomeTags",l),n.push(i.selectedTag)},closeAllTags(){s.dispatch("tags/delAllTags"),n.push("/")}}),c=e=>e.fullPath===o.fullPath,r=t=>{const a=e.value[t];a?n.push(a.fullPath):n.push("/")};return S((()=>{document.addEventListener("click",i.closeMenu)})),R((()=>{document.removeEventListener("click",i.closeMenu)})),B(i)})(i.tagList);return{isTagsbarShow:n,onScroll:e=>{i.handleScroll(e),c.closeMenu.value()},...i,...c}}}),_e=["onClick","onMouseup","onContextmenu"],Se={class:"flex items-center gap-x-1"};var Le=e(Ce,[["render",function(e,t,a,l,s,n){const o=d("CircleClose"),f=d("el-icon"),b=d("router-link"),k=d("el-scrollbar");return i(),c(v,null,[r("div",{class:T(["tags-container",{hide:!e.isTagsbarShow}])},[m(k,{ref:"scrollContainer",vertical:!1,class:"scroll-container",onWheel:A(e.onScroll,["prevent"])},{default:p((()=>[(i(!0),c(v,null,h(e.tagList,((t,a)=>(i(),g(b,{key:t.fullPath,to:t,ref_for:!0,ref:t=>e.setItemRef(a,t),custom:""},{default:p((({navigate:a,isExactActive:l})=>{var s,n,c;return[r("div",{class:T(["tags-item",l?"active":""]),onClick:a,onMouseup:A((a=>e.closeTag(t)),["middle"]),onContextmenu:A((a=>e.openMenu(t,a)),["prevent"])},[r("div",Se,[W(r("span",{class:"title"},"預收單 #"+u(null==(s=null==t?void 0:t.params)?void 0:s.id),513),[[E,!!(null==(n=null==t?void 0:t.params)?void 0:n.id)]]),W(r("span",{class:"title"},u(t.title),513),[[E,!(null==(c=null==t?void 0:t.params)?void 0:c.id)]]),e.isAffix(t)?I("",!0):(i(),g(f,{key:0,onClick:A((a=>e.closeTag(t)),["prevent","stop"])},{default:p((()=>[m(o)])),_:2},1032,["onClick"]))])],42,_e)]})),_:2},1032,["to"])))),128))])),_:1},8,["onWheel"])],2),W(r("ul",{style:F({left:e.left+"px",top:e.top+"px"}),class:"contextmenu"},[r("li",{onClick:t[0]||(t[0]=t=>e.refreshSelectedTag(e.selectedTag))},"刷新"),e.isAffix(e.selectedTag)?I("",!0):(i(),c("li",{key:0,onClick:t[1]||(t[1]=t=>e.closeTag(e.selectedTag))},"關閉")),r("li",{onClick:t[2]||(t[2]=(...t)=>e.closeOtherTags&&e.closeOtherTags(...t))},"關閉其他"),r("li",{onClick:t[3]||(t[3]=(...t)=>e.closeLeftTags&&e.closeLeftTags(...t))},"關閉左側"),r("li",{onClick:t[4]||(t[4]=(...t)=>e.closeRightTags&&e.closeRightTags(...t))},"關閉右側"),r("li",{onClick:t[5]||(t[5]=(...t)=>e.closeAllTags&&e.closeAllTags(...t))},"關閉全部")],4),[[E,e.visible]])],64)}],["__scopeId","data-v-5d839fe2"]]);const Me=n({setup(){const e=l(),t=a();return{cacheList:o((()=>e.state.tags.cacheList)),key:o((()=>t.fullPath))}}});const Ie=()=>{const e=l(),t=()=>{window.innerWidth<768?(e.commit("app/setDevice","mobile"),e.commit("app/setCollapse",1)):(e.commit("app/setDevice","desktop"),e.commit("app/setCollapse",0))};b((()=>{t(),window.addEventListener("resize",t)})),R((()=>{window.removeEventListener("resize",t)}))};const ze=n({name:"layout",components:{Sidebar:G,Topbar:we,Menus:Y,Tagsbar:Le,Breadcrumbs:X,Content:e(Me,[["render",function(e,t,a,l,s,n){const o=d("router-view");return i(),g(o,null,{default:p((({Component:t})=>[(i(),g(O,{include:e.cacheList},[(i(),g(f(t),{key:e.key}))],1032,["include"]))])),_:1})}]])},setup(){Ie();const e=l(),t=o((()=>e.state.layoutSettings)),a=o((()=>t.value.layout.isFluid)),s=o((()=>t.value.topbar.isFixed)),n=o((()=>t.value.menus.isShow)),i=o((()=>"horizontal"===t.value.menus.mode)),c=o((()=>i.value&&t.value.breadcrumbs.isShow)),r=x(!0);return{isFluid:a,isTopbarFixed:s,isMenusShow:n,isHorizontalMenu:i,isBreadcrumbsShow:c,paddingFlag:r,handleBreadcrumbsChange:e=>{r.value=e}}}}),He={class:"top"};var Pe=e(ze,[["render",function(e,t,a,l,s,n){const o=d("sidebar"),u=d("topbar"),p=d("menus"),f=d("tagsbar"),v=d("breadcrumbs"),h=d("Content");return i(),c("div",{class:T(["wrapper",{fluid:e.isFluid}])},[e.isMenusShow&&!e.isHorizontalMenu?(i(),g(o,{key:0})):I("",!0),r("div",{class:T(["right",{flex:e.isTopbarFixed}])},[r("div",He,[m(u),e.isMenusShow&&e.isHorizontalMenu?(i(),g(p,{key:0,mode:"horizontal"})):I("",!0),m(f),e.isBreadcrumbsShow?(i(),g(v,{key:1,onOnBreadcrumbsChange:e.handleBreadcrumbsChange},null,8,["onOnBreadcrumbsChange"])):I("",!0)]),r("div",{class:T(["main",{pt0:e.isBreadcrumbsShow&&e.paddingFlag}])},[m(h)],2)],2)],2)}],["__scopeId","data-v-31d2b024"]]);export{Pe as default};
