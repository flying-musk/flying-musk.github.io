import{r as e,o as l,q as a,G as t,H as s,x as i,C as o,a as r,w as n,K as d,D as m,u,N as c,c as p,O as g,k as b,h as f,f as h,X as x,T as y,U as w,Y as _,j as v,Q as k,A as C,Z as D,_ as S,S as V,$ as j}from"./element-plus.4376cb67.js";import{r as N,_ as z}from"./index.c1a5c498.js";import{_ as L}from"./index.47575a41.js";import{_ as T}from"./CardTwoCol.c5188255.js";import{_ as U}from"./SubTitle.11cb64b0.js";import{S as F}from"./ScrollToTop.3247de65.js";const O={class:"tracking-wider text-gray-500 text-xs"},R={class:"flex justify-between border-b bg-white text-gray-500 py-2 px-3"},q={class:"text-gray-700"},G={class:"grid grid-cols-2 border-t divide-x py-2 text-sm"},$={__name:"PosCard",props:{list:{type:Array,default:()=>[]}},setup:b=>(f,h)=>{const x=e("el-empty");return l(),a("div",O,[(l(!0),a(t,null,s(b.list,(({member_id:e,name:t,commit:s,amt_in:u,amt_out:c,remark:p,pos:g,ep_id:b})=>(l(),a("div",{class:"grid grid-cols-1 bg-white rounded mb-3",key:b},[i("header",R,[i("div",q,"#"+o(b),1),i("div",null,o(s),1)]),r(T,{item:{label:"會員編號",value:e}},{default:n((()=>[i("span",{class:d(["bg-opacity-20 px-2 py-1 tracking-widest rounded inline-block",{"bg-slate-300 text-gray-500":"原點位"===g,"bg-primary-50  text-primary-500":"原點位"!==g}])},o(g),3),m("｜ ")])),_:2},1032,["item"]),r(T,{item:{label:"姓名",value:t}},null,8,["item"]),r(T,{item:{label:"備註",value:p}},null,8,["item"]),i("footer",G,[i("div",{class:d(["text-center",{increase:u>0}])}," 補款:"+o(u),3),i("div",{class:d(["text-center",{decrease:c>0}])}," 扣款:"+o(c),3)])])))),128)),u(c)(b.list)?(l(),p(x,{key:0})):g("",!0)])}},A={class:"bg-white tracking-wider text-gray-500 text-xs rounded-md border-2",disabled:""},B=i("h3",{class:"flex-1"},"設定單筆扣補",-1),I={__name:"SetDeductCard",emits:["on-refresh"],setup(t,{emit:s}){const{proxy:d}=k(),c=b(null),p=f({loading:!1,isCollapse:!0,model:{action:"set_single",mbid:"",amount:null,remark:"",dtype:1,iscfm:0},rules:{mbid:[{required:!0,message:"",trigger:"blur"}],amount:[{required:!0,message:"",trigger:"blur"}],dtype:[{required:!0,message:"",trigger:"blur"}],remark:[{required:!0,message:"",trigger:"blur"}]}}),g=h((()=>p.loading?"確認中...":"確認")),C={handleSubmit:(e=0)=>{c.value.validate((async l=>{if(l){p.model.iscfm=e,p.loading=!0;const{code:l,data:a,msg:t}=await(e=>N({url:"api/sys/sp_epadj.php",method:"post",data:e}))(p.model);l>0?1===e?(d.$message({type:"success",message:t}),c.value.resetFields(),s("on-refresh")):d.$messageBox({title:t,message:v("div",{class:"space-y-2 tracking-wide text-gray-500 text-xs"},[v("p",{class:"heigh-light text-md"},a.mbinfo),v("div",{class:"flex justify-between gap-x-12"},[v("p",{class:"min-w-fit"},null,"備註："),v("p",{class:"font-light"},a.remark)]),v("div",{class:"flex justify-between pt-1 border-t-2  border-dashed"},[v("p",null,"目前餘額："),v("p",null,Number(a.bal).toLocaleString("zh-CN",{minimumFractionDigits:2}))]),v("div",{class:"flex justify-between pb-1 border-b"},[v("p",null,(1===a.dtype?"要扣款的金額":"要補錢的金額")+"："),v("p",{style:"color: "+(1===a.dtype?"tomato":"cadetblue")},Number(a.amount).toLocaleString("zh-CN",{minimumFractionDigits:2}))]),v("div",{class:"flex justify-between"},[v("p",null,"小計："),v("p",null,1===a.dtype?(Number(a.bal)-Number(a.amount)).toLocaleString("zh-CN",{minimumFractionDigits:2}):(Number(a.bal)+Number(a.amount)).toLocaleString("zh-CN",{minimumFractionDigits:2}))])]),showCancelButton:!0}).then((()=>{C.handleSubmit(1)})):d.$message({type:"error",message:t}),setTimeout((()=>{p.loading=!1}),500)}}))}};return(t,s)=>{const d=e("ArrowUp"),b=e("el-icon"),f=e("el-input"),h=e("el-form-item"),v=e("el-radio"),k=e("el-radio-group"),D=e("el-button"),S=e("el-form"),V=x("number");return l(),a("div",A,[i("header",{class:"bg-gray-50 text-gray-700 py-2 px-4 text-center shadow tracking-widest flex items-center cursor-pointer",onClick:s[0]||(s[0]=e=>p.isCollapse=!p.isCollapse)},[B,r(b,null,{default:n((()=>[y(r(d,null,null,512),[[w,p.isCollapse]]),y(r(u(_),null,null,512),[[w,!p.isCollapse]])])),_:1})]),y(i("div",null,[r(S,{class:"form p-2 mt-2",model:p.model,rules:p.rules,size:"small","label-width":"70","label-position":"left","hide-required-asterisk":"","scroll-to-error":"",ref_key:"refForm",ref:c},{default:n((()=>[r(h,{label:"會員編號",prop:"mbid"},{default:n((()=>[r(f,{class:"text",modelValue:p.model.mbid,"onUpdate:modelValue":s[1]||(s[1]=e=>p.model.mbid=e),"prefix-icon":"User",clearable:"",placeholder:"請輸入會員編號"},null,8,["modelValue"])])),_:1}),r(h,{label:"修正類型",prop:"dtype"},{default:n((()=>[r(k,{modelValue:p.model.dtype,"onUpdate:modelValue":s[2]||(s[2]=e=>p.model.dtype=e),size:"small"},{default:n((()=>[r(v,{label:1},{default:n((()=>[m("扣款")])),_:1}),r(v,{label:2},{default:n((()=>[m("補錢")])),_:1})])),_:1},8,["modelValue"])])),_:1}),r(h,{label:"扣捕金額",prop:"amount"},{default:n((()=>[y(r(f,{class:"text",modelValue:p.model.amount,"onUpdate:modelValue":s[3]||(s[3]=e=>p.model.amount=e),"prefix-icon":"Coin",clearable:"",placeholder:"請輸入扣捕金額"},null,8,["modelValue"]),[[V]])])),_:1}),r(h,{label:"備註",prop:"remark"},{default:n((()=>[r(f,{modelValue:p.model.remark,"onUpdate:modelValue":s[4]||(s[4]=e=>p.model.remark=e),autosize:{minRows:2,maxRows:5},placeholder:"請輸入備註",resize:"none",type:"textarea"},null,8,["modelValue"])])),_:1}),r(D,{loading:p.loading,size:"default",type:"primary",class:"w-full","auto-insert-space":"",onClick:C.handleSubmit},{default:n((()=>[m(o(u(g)),1)])),_:1},8,["loading","onClick"])])),_:1},8,["model","rules"])],512),[[w,p.isCollapse]])])}}};const E={id:"special-setting",class:"specialSetting h-full reactive"},H={class:"md:hidden pb-8 w-full"},K={class:"flex flex-col gap-y-3 md:bg-white md:h-full md:p-3 rounded-md"},M={class:"flex items-center justify-between"},P={class:"flex items-center gap-x-3"},Q={class:"hidden md:block"},X={class:"flex flex-col md:flex-row md:justify-between gap-y-3"},Y={class:"flex flex-col md:flex-row gap-3 items-center"},Z={class:"flex justify-between"},J={class:"flex flex-col w-full md:w-fit gap-3 md:flex-row"},W={class:"text-gray-500 self-end px-1"};var ee=z({__name:"index",setup(c){const{proxy:g}=k(),b=f({loading:!1,showSetting:!0,showSettingMobile:!1,selectedDate:14,search:"",searchOptions:[],pagination:{show:!0,total:0,page:1,take:20},columns:[{label:"會員編號",prop:"member_id",align:"right",fixed:"left",width:"70"},{label:"點位",prop:"pos",formatter:!0,align:"center",width:"100"},{label:"姓名",prop:"name",sortable:!0,width:"70"},{label:"補款",prop:"amt_in",align:"right",formatter:!0,sortable:!0,width:"80"},{label:"扣款",prop:"amt_out",align:"right",formatter:!0,sortable:!0,width:"80"},{label:"扣補編號",prop:"ep_id",align:"right",width:"70"},{label:"時間",prop:"commit",width:"85",sortable:!0},{label:"備註",prop:"remark"}],tableData:[]}),x=h((()=>{const{page:e,take:l}=b.pagination;if(b.search){const a=b.tableData.filter((e=>e.member_id===b.search)),t=a.filter(((a,t)=>t<e*l&&t>=l*(e-1)));return b.pagination.total=a.length,t}return b.pagination.total=b.tableData.length,b.tableData.filter(((a,t)=>t<e*l&&t>=l*(e-1)))})),_=h((()=>{if(b.search){return b.tableData.filter((e=>e.member_id===b.search))}return b.tableData}));C((()=>{v.handleGetDeductList()}));const v={handleGetDeductList:async()=>{b.loading=!0;const e={action:"deduct_list",days:b.selectedDate},{code:l,data:a,count:t=0,msg:s}=await(e=>N({url:"api/sys/sp_epadj.php",method:"post",data:e}))(e);if(1===l){b.tableData=a,b.pagination.total=Number(t);const e=a.map((e=>({member_id:e.member_id,name:e.name})));b.searchOptions=D(e,j)}else g.$message({type:"error",message:s});b.loading=!1},handleRest:()=>{b.search="",b.selectedDate=14,v.handleGetDeductList()},handleScrollToTop:()=>{const e=document.querySelector("#special-setting");e&&e.scrollIntoView({behavior:"smooth"})}};return(c,g)=>{const f=e("el-option"),h=e("el-select"),k=e("el-button"),C=e("el-col"),D=e("el-row");return l(),a("div",E,[r(D,{gutter:8,class:"h-full"},{default:n((()=>[r(C,{span:24,sm:b.showSetting?16:24,md:b.showSetting?16:24,lg:b.showSetting?18:24,class:"table-animation"},{default:n((()=>[i("div",H,[r(I,{onOnRefresh:v.handleGetDeductList},null,8,["onOnRefresh"])]),i("div",K,[i("header",M,[i("div",P,[r(U,{title:"扣補記錄",class:"min-w-fit"}),r(h,{modelValue:b.selectedDate,"onUpdate:modelValue":g[0]||(g[0]=e=>b.selectedDate=e),"value-key":"value",placeholder:"天數",size:"small",class:"max-w-[100px] select-date",onChange:v.handleGetDeductList},{prefix:n((()=>[m("最近")])),default:n((()=>[(l(),a(t,null,s(31,(e=>r(f,{key:e,label:`${e} 天`,value:e},null,8,["label","value"]))),64))])),_:1},8,["modelValue","onChange"])]),i("div",Q,[r(k,{type:"primary",icon:"Edit",plain:"",size:"small",onClick:g[1]||(g[1]=e=>b.showSetting=!b.showSetting)},{default:n((()=>[m("單筆扣補")])),_:1})])]),i("div",X,[i("div",Y,[r(h,{modelValue:b.search,"onUpdate:modelValue":g[2]||(g[2]=e=>b.search=e),"value-key":"value",placeholder:"會員編號",clearable:"",filterable:"",class:"w-full md:w-fit"},{default:n((()=>[(l(!0),a(t,null,s(b.searchOptions,(e=>(l(),p(f,{key:e.member_id,label:e.member_id,value:e.member_id},{default:n((()=>[i("div",Z,[i("span",null,o(e.member_id),1),i("span",null,o(e.name),1)])])),_:2},1032,["label","value"])))),128))])),_:1},8,["modelValue"]),i("div",J,[r(k,{type:"primary",class:"w-full md:w-fit","auto-insert-space":""},{default:n((()=>[m("搜尋")])),_:1}),i("div",null,[r(k,{bg:"","auto-insert-space":"",class:"w-full md:w-fit",onClick:v.handleRest},{default:n((()=>[m("重置")])),_:1},8,["onClick"])])])]),i("small",W,"共 "+o(b.pagination.total)+" 筆",1)]),r($,{list:u(_),class:"md:hidden"},null,8,["list"]),r(L,{columns:b.columns,"table-data":u(x),loading:b.loading,total:b.pagination.total,take:b.pagination.take,page:b.pagination.page,"onUpdate:page":g[3]||(g[3]=e=>b.pagination.page=e),class:"hidden md:block"},{pos:n((({row:e})=>[i("p",{class:d(["mx-3 bg-opacity-20 rounded text-center text-xs leading-5",{"bg-slate-300 text-gray-500":"原點位"===e.pos,"bg-primary-50  text-primary-500":"原點位"!==e.pos}])},o(e.pos),3)])),amt_in:n((({row:e})=>[i("p",{class:d({increase:e.amt_in>0})},o(Number(e.amt_in).toLocaleString("zh-CN",{minimumFractionDigits:2})),3)])),amt_out:n((({row:e})=>[i("p",{class:d({decrease:e.amt_out>0})},o(Number(e.amt_out).toLocaleString("zh-CN",{minimumFractionDigits:2})),3)])),_:1},8,["columns","table-data","loading","total","take","page"])])])),_:1},8,["sm","md","lg"]),r(S,{name:"slide-fade",mode:"out-in"},{default:n((()=>[y(r(C,{span:24,sm:8,md:8,lg:6},{default:n((()=>[r(I,{onOnRefresh:v.handleGetDeductList,class:"hidden md:block"},null,8,["onOnRefresh"])])),_:1},512),[[w,b.showSetting]])])),_:1})])),_:1}),r(F,{onClick:V(v.handleScrollToTop,["prevent"])},null,8,["onClick"])])}}},[["__scopeId","data-v-0f647e4e"]]);export{ee as default};
