import{r as e,_ as a}from"./index.b3300bbf.js";import{_ as l}from"./SubTitle.11cb64b0.js";import{o as t,q as i,x as r,C as n,K as o,h as s,A as d,f as m,a as c,w as u,G as b,H as g,D as p,u as v,Q as f,r as y,c as h}from"./element-plus.4376cb67.js";import{_ as w}from"./index.47575a41.js";const x=a=>e({url:"money",method:"post",data:a}),k={class:"bg-white border rounded-lg p-3 tracking-widest flex justify-between items-center"},C={class:"text-primary-500 text-sm font-medium"},T={__name:"MoneyCard",props:{title:{type:String,default:""},value:{type:String,default:""},increase:{type:Boolean,default:!1},decrease:{type:Boolean,default:!1}},setup:e=>(a,l)=>(t(),i("div",k,[r("p",C,n(e.title),1),r("p",{class:o(["font-bold text-gray-700 text-xl inline-flex items-center space-x-2",{increase:e.increase,decrease:e.decrease}])},[r("span",null,"¥"+n(e.value),1)],2)]))};const _={id:"money",class:"h-full reactive"},S={class:"flex flex-col gap-y-3 md:gap-y-6 md:bg-white md:h-full md:p-3 rounded-md"},N={class:"flex justify-between md:items-center flex-col md:flex-row gap-y-3"},M={class:"flex flex-col md:flex-row md:items-center gap-y-3 md:gap-x-3"},I={class:"flex flex-col md:flex-row md:justify-between gap-3"},D={class:"flex justify-between"},V={class:"text-gray-500 self-end min-w-[96px] text-right"},j={class:"grid md:grid-cols-4 gap-3"},O={class:"grid md:grid-cols-4 gap-3"},F={key:0,class:"text-center"},B={key:1,class:"flex flex-col gap-y-3 md:gap-y-6 md:bg-white md:h-full md:p-3 rounded-md"},A={class:"grid md:grid-cols-3 gap-3"},U={class:"text-gray-500 self-end text-[13px]"};var L=a({__name:"index",setup(e){const{proxy:a}=f(),k=s({isDialogVisible:!1,loading:!0,totalIn:"0.00",totalOut:"0.00",totalTrans:"0.00",balance:"0.00",search:"",searchOptions:[],pagination:{total:0,page:1,take:30},message:"",columns:[{label:"會員編號",prop:"mbid",align:"left",sortable:!0,formatter:!0},{label:"會員名稱",prop:"name",sortable:!1,align:"center"},{label:"支出 (¥)",prop:"amtout",align:"right",sortable:!0,formatter:!0},{label:"收入 (¥)",prop:"amtin",align:"right",sortable:!0,formatter:!0},{label:"轉出 (¥)",prop:"transfer",align:"right",sortable:!0,formatter:!0},{label:"結餘 (¥)",prop:"bal",align:"right",sortable:!0,formatter:!0},{label:"操作",prop:"operation",formatter:!0,align:"center"}],tableData:[],individualMember:{isDialogSimplified:!1,loading:!0,totalIn:"0.00",totalOut:"0.00",balance:"0.00",message:"",columns:[{label:"日期",prop:"commit",sortable:!0,width:"100"},{label:"類型",prop:"type",width:"100"},{label:"支出 (¥)",prop:"amtout",align:"right",sortable:!0,formatter:!0},{label:"收入 (¥)",prop:"amtin",align:"right",sortable:!0,formatter:!0},{label:"備註",prop:"remark"}],tableData:[]}});d((()=>{L.handleFetchAll()}));const C=m((()=>{const{page:e,take:a}=k.pagination;return k.tableData.filter(((l,t)=>t<e*a&&t>=a*(e-1)))})),L={handleFetchAll:async()=>{k.loading=!0;const{code:e,data:{sum:{Bal:l,Total_in:t,Total_out:i,Total_trans:r},detail:n},msg:o}=await x({action:"all"});setTimeout((()=>{k.loading=!1}),500),1===e?(k.totalIn=L.convertNumberToCurrencyString(t),k.totalOut=L.convertNumberToCurrencyString(i),k.totalTrans=L.convertNumberToCurrencyString(r),k.balance=L.convertNumberToCurrencyString(l),k.searchOptions=n.map((e=>({memberId:e.mbid,name:e.name}))),k.message=o.replace(/\d+(?= 筆)/g,(e=>parseInt(e).toLocaleString())),k.pagination.total=n.length,k.tableData=n.map((e=>({mbid:e.mbid,name:e.name,amtout:Number(e.amtout),amtin:Number(e.amtin),transfer:Number(e.transfer),bal:Number(e.bal),operation:e.mbid})))):a.$message({type:"error",message:o})},handleFetchIndividual:async e=>{const l={action:"individual",mbid:e},{code:t,data:i,msg:r}=await x(l),{sum:n,detail:o}=i||{},{Bal:s,Total_in:d,Total_out:m}=n||{};setTimeout((()=>{k.individualMember.loading=!1}),500),1===t?(k.individualMember.isDialogSimplified=void 0===i,void 0===i?k.individualMember.message=r:(k.individualMember.message=r.replace(/\d+(?= 筆)/g,(e=>parseInt(e).toLocaleString())),k.individualMember.totalIn=L.convertNumberToCurrencyString(d),k.individualMember.totalOut=L.convertNumberToCurrencyString(m),k.individualMember.balance=L.convertNumberToCurrencyString(s),k.individualMember.tableData=o.map((e=>({commit:e.commit,type:e.type,amtin:Number(e.amtin),amtout:Number(e.amtout),remark:e.remark}))))):a.$message({type:"error",message:r})},searchClick:()=>{k.isDialogVisible=!0,L.handleFetchIndividual(k.search)},resetClick:()=>{k.search=""},linkClick:e=>{k.isDialogVisible=!0,L.handleFetchIndividual(e)},convertNumberToCurrencyString:e=>new Intl.NumberFormat("en",{maximumFractionDigits:2,minimumFractionDigits:2}).format(e),dialogClose:()=>{k.individualMember.loading=!0}};return(e,a)=>{const s=y("el-option"),d=y("el-select"),m=y("el-button"),f=y("el-skeleton-item"),x=y("el-link"),$=y("el-skeleton"),q=y("el-dialog");return t(),i("div",_,[r("div",S,[r("header",N,[r("div",M,[c(l,{title:"金流管理",class:"min-w-fit"})]),r("div",I,[c(d,{modelValue:k.search,"onUpdate:modelValue":a[0]||(a[0]=e=>k.search=e),"value-key":"value",placeholder:"會員編號",clearable:"",filterable:"",class:"w-full md:w-fit"},{default:u((()=>[(t(!0),i(b,null,g(k.searchOptions,(e=>(t(),h(s,{key:e.memberId,label:e.memberId,value:e.memberId},{default:u((()=>[r("div",D,[r("span",null,n(e.memberId),1),r("span",null,n(e.name),1)])])),_:2},1032,["label","value"])))),128))])),_:1},8,["modelValue"]),c(m,{type:"primary",class:"w-full md:w-fit",disabled:""===k.search,"auto-insert-space":"",onClick:L.searchClick},{default:u((()=>[p("搜尋")])),_:1},8,["disabled","onClick"]),r("div",null,[c(m,{bg:"","auto-insert-space":"",class:"w-full md:w-fit",onClick:L.resetClick},{default:u((()=>[p("重置")])),_:1},8,["onClick"])]),r("small",V,n(k.message),1)])]),c($,{loading:k.loading,animated:""},{template:u((()=>[r("div",j,[(t(),i(b,null,g(4,((e,a)=>r("div",{class:"bg-white rounded-lg border shadow-gray-400/20 p-3 flex justify-between items-center h-[54px]",key:a},[c(f,{variant:"text",style:{width:"20%"}}),c(f,{variant:"h1",style:{width:"40%"}})]))),64))])])),default:u((()=>[r("div",O,[c(T,{title:"總支出",value:k.totalOut,decrease:!0},null,8,["value"]),c(T,{title:"總收入",value:k.totalIn,increase:!0},null,8,["value"]),c(T,{title:"總轉出",value:k.totalTrans,decrease:!0},null,8,["value"]),c(T,{title:"總結餘",value:k.balance,increase:!0},null,8,["value"])]),c(w,{columns:k.columns,"table-data":v(C),total:k.pagination.total,take:k.pagination.take,page:k.pagination.page,"onUpdate:page":a[1]||(a[1]=e=>k.pagination.page=e)},{mbid:u((({row:e})=>[r("p",null,[c(x,{class:"link",onClick:a=>L.linkClick(e.mbid)},{default:u((()=>[p(n(e.mbid),1)])),_:2},1032,["onClick"])])])),amtout:u((({row:e})=>[r("p",{class:o({decrease:e.amtout>0})},n(L.convertNumberToCurrencyString(e.amtout)),3)])),amtin:u((({row:e})=>[r("p",{class:o({increase:e.amtin>0})},n(L.convertNumberToCurrencyString(e.amtin)),3)])),transfer:u((({row:e})=>[r("p",{class:o({decrease:e.transfer>0})},n(L.convertNumberToCurrencyString(e.transfer)),3)])),bal:u((({row:e})=>[r("p",{class:o({increase:e.bal>0,decrease:e.bal<0})},n(L.convertNumberToCurrencyString(e.bal)),3)])),operation:u((({row:e})=>[r("p",null,[c(x,{class:"link",onClick:a=>L.linkClick(e.operation)},{default:u((()=>[p("查看")])),_:2},1032,["onClick"])])])),_:1},8,["columns","table-data","total","take","page"])])),_:1},8,["loading"]),c(q,{modelValue:k.isDialogVisible,"onUpdate:modelValue":a[2]||(a[2]=e=>k.isDialogVisible=e),width:"80vw","align-center":"",onClose:L.dialogClose},{default:u((()=>[k.individualMember.isDialogSimplified?(t(),i("div",F,n(k.individualMember.message),1)):(t(),i("div",B,[r("div",A,[c(T,{title:"總支出",decrease:!0,value:k.individualMember.totalOut},null,8,["value"]),c(T,{title:"總收入",value:k.individualMember.totalIn,increase:!0},null,8,["value"]),c(T,{title:"總結餘",value:k.individualMember.balance,increase:!0},null,8,["value"])]),c(w,{loading:k.individualMember.loading,columns:k.individualMember.columns,"table-data":k.individualMember.tableData},{amtout:u((({row:e})=>[r("p",{class:o({decrease:e.amtout>0})},n(L.convertNumberToCurrencyString(e.amtout)),3)])),amtin:u((({row:e})=>[r("p",{class:o({increase:e.amtin>0})},n(L.convertNumberToCurrencyString(e.amtin)),3)])),_:1},8,["loading","columns","table-data"]),r("small",U,n(k.individualMember.message),1)]))])),_:1},8,["modelValue","onClose"])])])}}},[["__scopeId","data-v-7ec33bd6"]]);export{L as default};
